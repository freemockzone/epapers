<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ePapers Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="light dark" />
    <style>
        /* ================== General Styles ================== */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* ===== Glass & Animations ===== */
        .glass {
            backdrop-filter: saturate(140%) blur(14px);
            -webkit-backdrop-filter: saturate(140%) blur(14px);
            background: rgba(255, 255, 255, 0.65);
        }

        .dark .glass {
            background: rgba(17, 24, 39, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .soft-shadow {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .hover-float {
            transition: transform .2s ease, box-shadow .2s ease;
        }

        .hover-float:hover {
            transform: translateY(-4px);
            box-shadow: 0 14px 32px rgba(0, 0, 0, 0.10);
        }

        .spin-slow {
            animation: spin 18s linear infinite;
        }

        /* ================== POPUP STYLES ================== */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(3px);
            z-index: 9998;
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .popup.show {
            display: block;
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .popup-content {
            padding: 2rem;
            border-radius: 1.5rem;
            background-color: #fff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        @media (prefers-color-scheme: dark) {
            .popup-content {
                background-color: #1a202c;
            }
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 22px;
            cursor: pointer;
            color: #fff;
            font-weight: bold;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #ffeb3b;
        }

        /* Styles for the "Subscribe" pop-up as per your original code */
        #subscriptionPopup {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 30px 25px;
            width: 360px;
            color: #fff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            font-family: "Segoe UI", sans-serif;
        }

        #subscriptionPopup h2 {
            margin-bottom: 12px;
            font-size: 20px;
            font-weight: bold;
        }

        #subscriptionPopup p {
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        #subscriptionPopup .highlight {
            color: #ffeb3b;
            font-weight: bold;
            margin: 10px 0;
            font-size: 16px;
        }

        #subscriptionPopup button {
            margin-top: 15px;
            padding: 10px 22px;
            background: #ff5252;
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        #subscriptionPopup button:hover {
            background: #e53935;
        }


        /* ================== 100 COLOR BACKGROUND ANIMATION (SMOOTH) ================== */
        .bg-gradient {
            background: linear-gradient(to right, #FF0000, #FF7F00, #FFFF00, #7FFF00, #00FF00, #00FF7F, #00FFFF, #007FFF, #0000FF, #7F00FF, #FF00FF, #FF007F, #F0F8FF, #FAEBD7, #00FFFF, #7FFFD4, #F0FFFF, #F5F5DC, #FFE4C4, #000000, #FFEBCD, #0000FF, #8A2BE2, #A52A2A, #DEB887, #7FFF00, #D2691E, #FF7F50, #6495ED, #FFF8DC, #DC143C, #00FFFF, #00008B, #008B8B, #B8860B, #A9A9A9, #006400, #BDB76B, #8B008B, #556B2F, #FF8C00, #9932CC, #8B0000, #E9967A, #8FBC8F, #483D8B, #2F4F4F, #00CED1, #9400D3, #FF1493, #00BFFF, #696969, #1E90FF, #B22222, #228B22, #FFFAFA, #3CB371, #FFD700, #DAA520, #808080, #008000, #ADFF2F, #F0FFF0, #FF69B4, #CD5C5C, #4B0082, #FFFFF0, #F0E68C, #E0FFFF, #ADD8E6, #F08080, #E0FFFF, #FAF0E6, #D3D3D3, #90EE90, #FFB6C1, #FFA07A, #20B2AA, #87CEFA, #778899, #B0C4DE, #FFFFE0, #00FF00, #32CD32, #FAF0E6, #FF00FF, #800080, #6A5ACD, #4169E1, #F4A460, #2E8B57, #FFF5EE, #A0522D, #C0C0C0, #87CEEB, #6B8E23, #FFDAB9, #DDA0DD, #FF4500, #FA8072, #7B68EE, #48D1CC, #C71585, #191970, #F5FFFA, #FFE4E1, #FFE4B5, #FFDEAD, #000080, #FDF5E6, #808000, #6B8E23, #FFA500, #FF4500, #DA70D6, #EEE8AA, #98FB98, #AFEEEE, #1E90FF, #FF1493, #DCDCDC, #FFF8DC, #F0FFF0, #B0E0E6, #BC8F8F, #CD853F, #FFC0CB, #F5F5F5, #800000, #008080, #4682B4, #D2B48C, #008000, #D87093, #FF6347, #40E0D0, #EE82EE, #F5DEB3, #FFFFFF, #F5F5F5, #FFFF00, #9ACD32);
            background-size: 10000% 100%;
            animation: color-shift 120s infinite linear;
            color: white;
        }

        @keyframes color-shift {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }
    </style>
</head>

<body
    class="h-full bg-gradient-to-br from-slate-50 via-white to-slate-100 text-slate-800 dark:from-slate-900 dark:via-slate-950 dark:to-black dark:text-slate-100">

    <div class="min-h-screen grid grid-cols-1 lg:grid-cols-[270px,1fr]">

        <aside id="sidebar" class="glass soft-shadow fixed top-0 left-0 w-64 h-full p-5 flex flex-col gap-6 z-50 transform -translate-x-full transition-transform ease-in-out duration-300
                    lg:sticky lg:top-0 lg:left-auto lg:w-auto lg:h-screen lg:transform-none lg:p-6 lg:z-40">
            <button id="closeSidebar" class="absolute top-4 right-4 text-3xl text-slate-500 lg:hidden">&times;</button>

            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-indigo-500 via-sky-500 to-emerald-400 spin-slow">
                </div>
                <div>
                    <h1 class="text-xl font-extrabold tracking-tight">ePapers</h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400 -mt-0.5">Govt Job Aspirants</p>
                </div>
            </div>

            <nav class="mt-1 lg:mt-2">
                <ul class="space-y-2">
                    <li><a href="#dashboard"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>üè†</span><span>Dashboard</span></a>
                    </li>
                    <li><a href="#current-affairs"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>üóûÔ∏è</span><span>Current
                                Affairs</span></a></li>
                    <li><a href="demo-2.html"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>üéØ</span><span>Daily
                                MCQ's</span></a></li>
                    <li><a href="#epapers"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>üìÑ</span><span>ePapers</span></a>
                    </li>
                    <li><a href="#about"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>‚ÑπÔ∏è</span><span>About</span></a>
                    </li>
                    <li><a href="#contact"
                            class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800"><span>üìß</span><span>Contact</span></a>
                    </li>
                </ul>
            </nav>

            <div class="mt-auto hidden lg:block">
                <a href="subscribe.html"
                    class="bg-gradient w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl font-bold shadow-lg hover:opacity-95 transition">
                    üöÄ Subscribe
                </a>
            </div>

            <div class="flex items-center gap-2 pt-2">
                <button id="themeToggle"
                    class="w-full px-3 py-2 rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 font-semibold hover:opacity-90 transition">
                    Toggle Dark/Light
                </button>
            </div>
        </aside>

        <main class="p-4 sm:p-6 lg:p-8">

            <header id="dashboard" class="mb-6 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
                <button id="openSidebar" class="p-2 -ml-2 text-2xl text-slate-500 lg:hidden">
                    ‚ò∞
                </button>

                <div>
                    <h2 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Dashboard</h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Daily Current Affairs ‚Ä¢ ePapers (auto delete
                        in 24h)</p>
                </div>
                <div class="flex flex-col gap-2 md:flex-row md:items-center">
                    <input id="searchBox" type="search" placeholder="Search current affairs‚Ä¶"
                        class="glass soft-shadow px-4 py-2 rounded-xl outline-none w-full md:w-64 max-w-full text-sm placeholder:text-slate-400" />
                    <a href="subscribe.html"
                        class="bg-gradient hidden md:inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold shadow-lg hover:opacity-95 transition">Subscribe</a>
                </div>
            </header>

            <section class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="glass soft-shadow rounded-2xl p-5 hover-float">
                    <p class="text-sm text-slate-500 dark:text-slate-400">Today‚Äôs Affairs</p>
                    <p id="statAffairs" class="text-3xl font-extrabold mt-1">0</p>
                </div>
                <div class="glass soft-shadow rounded-2xl p-5 hover-float">
                    <p class="text-sm text-slate-500 dark:text-slate-400">Active ePapers</p>
                    <p id="statPapers" class="text-3xl font-extrabold mt-1">0</p>
                </div>
                <div class="glass soft-shadow rounded-2xl p-5 hover-float">
                    <p class="text-sm text-slate-500 dark:text-slate-400">Expiring <span class="hidden sm:inline">in
                            < 6h</span>
                    </p>
                    <p id="statExpiring" class="text-3xl font-extrabold mt-1">0</p>
                </div>
                <div class="glass soft-shadow rounded-2xl p-5 hover-float">
                    <p class="text-sm text-slate-500 dark:text-slate-400">Subscribers</p>
                    <p class="text-3xl font-extrabold mt-1">1213</p>
                </div>
            </section>

            <section id="current-affairs" class="mb-10">
                <div class="flex flex-col sm:flex-row items-start sm:items-end justify-between mb-4 gap-4">
                    <h3 class="text-xl font-bold">üóûÔ∏è Daily Current Affairs</h3>
                    <div class="flex flex-col sm:flex-row sm:items-center gap-2 text-sm w-full sm:w-auto">
                        <label for="filterDate" class="text-slate-500 dark:text-slate-400 hidden sm:block">Filter
                            date:</label>
                        <input id="filterDate" type="date"
                            class="glass soft-shadow px-3 py-2 rounded-lg outline-none w-full sm:w-auto" />
                        <button id="clearFilters"
                            class="px-3 py-2 rounded-lg bg-slate-900 text-white dark:bg-white dark:text-slate-900">Clear</button>
                    </div>
                </div>

                <div id="affairsFeed" class="space-y-4">
                </div>

                <div id="paginationControls" class="flex justify-center items-center gap-4 mt-6">
                    <button id="prevBtn"
                        class="px-4 py-2 rounded-lg bg-slate-900 text-white dark:bg-white dark:text-slate-900 disabled:opacity-50 disabled:cursor-not-allowed">
                        Previous
                    </button>
                    <span id="pageInfo" class="text-sm text-slate-600 dark:text-slate-300"></span>
                    <button id="nextBtn"
                        class="px-4 py-2 rounded-lg bg-slate-900 text-white dark:bg-white dark:text-slate-900 disabled:opacity-50 disabled:cursor-not-allowed">
                        Next
                    </button>
                </div>
            </section>

            <section id="epapers" class="mb-12">
                <h3 class="text-xl font-bold mb-4">üìÑ Today‚Äôs ePapers (auto-delete after 24h)</h3>
                <div id="epaperGrid" class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
                </div>
            </section>

            <section id="about" class="glass soft-shadow rounded-2xl p-6 mb-8">
                <h3 class="text-lg font-bold mb-2">‚ÑπÔ∏è About</h3>
                <p class="text-sm leading-6 text-slate-600 dark:text-slate-300">
                    Free Mock Zone is a free portal for SSC, UPSC, Banking, Railways and other competitive exams.
                    We publish Daily Current Affairs and provide popular ePapers for 24 hours to keep access fair and
                    focused.
                </p>
            </section>

            <section id="contact" class="glass soft-shadow rounded-2xl p-6">
                <h3 class="text-lg font-bold mb-2">üìß Contact</h3>
                <p class="text-sm text-slate-600 dark:text-slate-300">
                    Write to us at <a href="#" class="underline">Not Available</a>
                </p>
            </section>

            <a href="subscribe.html"
                class="bg-gradient fixed bottom-5 right-5 md:hidden inline-flex items-center gap-2 px-4 py-3 rounded-2xl font-bold shadow-xl">
                üöÄ Subscribe
            </a>

            <div id="sidebarBackdrop"
                class="fixed inset-0 bg-black opacity-0 z-40 hidden transition-opacity duration-300 ease-in-out lg:hidden">
            </div>

            <footer class="text-xs mt-12 text-slate-500 dark:text-slate-400 text-center">
                ¬© 2025 ePapers Hub ‚Ä¢ Built for learners with ‚ù§Ô∏è by Ankit 8168305050.
            </footer>
        </main>
    </div>

    <div class="overlay" id="overlay"></div>

    <div class="popup" id="subscriptionPopup">
        <span class="close-btn" onclick="closePopup('subscriptionPopup')">&times;</span>
        <h2>üìö Stay Ahead with Daily e-Papers & Study Material!</h2>
        <p>Access newspapers, current affairs, and exam-ready notes ‚Äî all in one place.</p>
        <p><b>Your one-stop hub for UPSC, SSC, Banking & State Exams.</b></p>
        <p class="highlight">üîî Special Independence Offer: Flat 50% Off Premium Access</p>
        <button onclick="window.location.href='subscribe.html'">Subscribe Now</button>
        <p style="margin-top:10px;">üéâ Celebrate Knowledge. Empower Your Preparation.<br>
            üìñ Exclusive <b>Student Discount Available!</b></p>
    </div>

    <div id="offerPopup" class="popup">
        <span class="close-btn" onclick="closePopup('offerPopup')">&times;</span>
        <div class="popup-content">
            <h2 class="text-2xl font-bold mb-4">üí° Support Free Learning for Aspirants!</h2>
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                We created <b class="text-gray-900 dark:text-gray-100">epapers.netlify.app</b> as a <b
                    class="text-gray-900 dark:text-gray-100">100% free platform</b> for government job aspirants ‚Äî with
                e-papers, daily quizzes, live news, and important study material.
            </p>

            <p class="text-gray-700 dark:text-gray-300 mb-4">
                Your small support will help us:
            </p>

            <ul class="list-none space-y-2 mb-6">
                <li class="flex items-center text-gray-700 dark:text-gray-300">
                    <span class="mr-2 text-green-500">‚úÖ</span> Keep the platform free & ad-free
                </li>
                <li class="flex items-center text-gray-700 dark:text-gray-300">
                    <span class="mr-2 text-green-500">‚úÖ</span> Add more quizzes, notes, and updates
                </li>
                <li class="flex items-center text-gray-700 dark:text-gray-300">
                    <span class="mr-2 text-green-500">‚úÖ</span> Cover hosting & maintenance costs
                </li>
            </ul>

            <p class="text-gray-700 dark:text-gray-300 text-center mb-4">
                üìå <b>Scan the UPI QR Code below to donate</b>
            </p>

            <div class="flex justify-center">
                <img src="Airtel.jpg" alt="UPI QR Code to donate"
                    class="w-48 h-48 mb-4 border border-gray-300 dark:border-gray-600 rounded-lg" />
            </div>

            <p class="text-sm text-gray-600 dark:text-gray-400 text-center mb-6">
                Every contribution, no matter how small, empowers thousands of aspirants like you.
            </p>

            <div class="flex justify-end mt-4">
                <button onclick="closePopup('offerPopup')"
                    class="px-4 py-2 rounded-lg border border-transparent text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    üôè Thank you for supporting Free Learning!
                </button>
            </div>
        </div>
    </div>

    <script>
        /* ================== THEME ================== */
        const root = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('fmz-theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            root.classList.add('dark');
        }
        themeToggle.addEventListener('click', () => {
            root.classList.toggle('dark');
            localStorage.setItem('fmz-theme', root.classList.contains('dark') ? 'dark' : 'light');
        });

        /* ================== MOBILE MENU ================== */
        const sidebar = document.getElementById('sidebar');
        const openSidebarBtn = document.getElementById('openSidebar');
        const closeSidebarBtn = document.getElementById('closeSidebar');
        const sidebarBackdrop = document.getElementById('sidebarBackdrop');

        function toggleSidebar(show) {
            if (show) {
                sidebar.classList.remove('-translate-x-full');
                sidebarBackdrop.classList.remove('hidden');
                setTimeout(() => sidebarBackdrop.classList.add('opacity-40'), 10);
            } else {
                sidebar.classList.add('-translate-x-full');
                sidebarBackdrop.classList.remove('opacity-40');
                setTimeout(() => sidebarBackdrop.classList.add('hidden'), 300);
            }
        }

        openSidebarBtn.addEventListener('click', () => toggleSidebar(true));
        closeSidebarBtn.addEventListener('click', () => toggleSidebar(false));
        sidebarBackdrop.addEventListener('click', () => toggleSidebar(false));

        const navLinks = sidebar.querySelectorAll('a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 1024) {
                    toggleSidebar(false);
                }
            });
        });


        /* ================== DATA (edit daily) ================== */
        let currentAffairs = [];
        let filteredAffairs = [];
        let currentPage = 1;
        const pageSize = 15;

        // E-PAPER DATA & HELPERS
        function getSixAMISTTimestamp() {
            const now = new Date();
            const istOffsetMs = 5.5 * 60 * 60 * 1000;
            const sixAMIST = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 6, 0, 0);
            const localOffsetMs = sixAMIST.getTimezoneOffset() * 60 * 1000;
            const addedAtTimestamp = sixAMIST.getTime() - localOffsetMs - istOffsetMs;
            return addedAtTimestamp;
        }

        const epapers = [
            { title: 'The Hindu Delhi Edition', url: 'https://jumpshare.com/s/gTYPaG4kOldYOrW8jkDQ', addedAt: getSixAMISTTimestamp(), thumbnailUrl: '1.png' },
            { title: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ç ‡§á‡§Ç‡§∏‡§æ‡§® ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§', url: '#', addedAt: getSixAMISTTimestamp(), thumbnailUrl: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä.png' },
            { title: 'Indian Express Delhi', url: 'https://limewire.com/d/bf43f#5T1GVMJWE6', addedAt: getSixAMISTTimestamp(), thumbnailUrl: '3.png' },
            { title: 'Business Line', url: '#', addedAt: getSixAMISTTimestamp(), thumbnailUrl: 'wip.png' },
            { title: '‡§Æ‡§∂‡•Ä‡§® ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§ - ‡§¶ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ç', url: 'https://jumpshare.com/s/82jPZwqeaUrQ25xWUd8T', addedAt: getSixAMISTTimestamp(), thumbnailUrl: '5.png' }
        ];

        /* ================== HELPERS ================== */
        const fmtDate = d => new Date(d).toLocaleDateString(undefined, { day: '2-digit', month: 'short', year: 'numeric' });

        const timeLeft = (addedAt) => {
            const expiry = addedAt + 24 * 60 * 60 * 1000;
            const diff = expiry - Date.now();
            if (diff <= 0) return { expired: true, h: 0, m: 0 };
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            return { expired: false, h, m };
        };

        /* ================== RENDER: AFFAIRS ================== */
        const affairsFeed = document.getElementById('affairsFeed');
        const searchBox = document.getElementById('searchBox');
        const filterDate = document.getElementById('filterDate');
        const clearFilters = document.getElementById('clearFilters');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');

        function renderPaginatedAffairs() {
            const totalPages = Math.ceil(filteredAffairs.length / pageSize);

            if (filteredAffairs.length === 0) {
                affairsFeed.innerHTML = `<div class="glass soft-shadow rounded-2xl p-6 text-sm">No items match your filter.</div>`;
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                pageInfo.textContent = '';
                return;
            }

            prevBtn.style.display = 'inline-block';
            nextBtn.style.display = 'inline-block';

            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredAffairs.length);
            const articlesToRender = filteredAffairs.slice(startIndex, endIndex);

            affairsFeed.innerHTML = articlesToRender
                .map(item => `
            <article class="glass soft-shadow rounded-2xl p-5 hover-float">
              <div class="flex items-center justify-between gap-3 mb-1">
                <h4 class="font-semibold">${item.title}</h4>
                <span class="text-xs px-2 py-1 rounded-lg bg-slate-900 text-white dark:bg-white dark:text-slate-900">${fmtDate(item.date)}</span>
              </div>
              <p class="text-sm text-slate-600 dark:text-slate-300">${item.summary}</p>
              <div class="mt-3 flex flex-wrap items-center gap-2">
                ${item.tags?.map(t => `<span class="text-xs px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-800">${t}</span>`).join('')}
                <a href="${item.link}" target="_blank" class="ml-auto text-sm underline">Read more ‚Üí</a>
              </div>
            </article>
            `).join('');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage >= totalPages;
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function filterAffairs() {
            const q = (searchBox.value || '').toLowerCase().trim();
            const d = filterDate.value;

            filteredAffairs = currentAffairs.filter(a => {
                const matchesText = [a.title, a.summary, ...(a.tags || [])].join(' ').toLowerCase().includes(q);
                const matchesDate = !d || a.date === d;
                return matchesText && matchesDate;
            });

            filteredAffairs.sort((a, b) => new Date(b.date) - new Date(a.date));
            currentPage = 1;

            renderPaginatedAffairs();

            document.getElementById('statAffairs').textContent = filteredAffairs.length;
        }

        searchBox.addEventListener('input', filterAffairs);
        filterDate.addEventListener('change', filterAffairs);
        clearFilters.addEventListener('click', () => { searchBox.value = ''; filterDate.value = ''; filterAffairs(); });

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderPaginatedAffairs();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage * pageSize < filteredAffairs.length) {
                currentPage++;
                renderPaginatedAffairs();
            }
        });

        /* ================== RENDER: EPAPERS ================== */
        const epaperGrid = document.getElementById('epaperGrid');
        function renderPapers() {
            const active = epapers.filter(p => !timeLeft(p.addedAt).expired);
            epaperGrid.innerHTML = active.map(p => {
                const t = timeLeft(p.addedAt);
                const warn = (t.h < 6);
                return `
            <div class="glass soft-shadow rounded-2xl p-5 hover-float flex flex-col gap-3">
              <img src="${p.thumbnailUrl}" alt="Thumbnail for ${p.title}" class="w-full h-[30rem] object-cover rounded-xl" onerror="this.src='https://placehold.co/400x800/E5E7EB/4B5563?text=Image+Not+Found'" />
              
              <div class="flex items-start justify-between gap-3">
                <h4 class="font-semibold">${p.title}</h4>
                <span class="text-[10px] px-2 py-1 rounded-lg ${warn ? 'bg-rose-600 text-white' : 'bg-emerald-600 text-white'}">
                  ${warn ? 'Expiring Soon' : 'Active'}
                </span>
              </div>
              <p class="text-sm text-slate-600 dark:text-slate-300">Available for <b>${String(t.h).padStart(2, '0')}h ${String(t.m).padStart(2, '0')}m</b></p>
              <a href="${p.url}" target="_blank"
                 class="inline-flex justify-center items-center gap-2 px-4 py-2 rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 font-semibold">
                Download
              </a>
            </div>
            `;
            }).join('');

            document.getElementById('statPapers').textContent = active.length;
            document.getElementById('statExpiring').textContent = active.filter(p => timeLeft(p.addedAt).h < 6).length;
        }

        /* ================== FETCH & RENDER ================== */
        const feeds = [
            { source: "The Hindu", url: "https://www.thehindu.com/news/national/feeder/default.rss" },
            { source: "Indian Express", url: "https://indianexpress.com/feed/" },
            { source: "Mint", url: "https://www.livemint.com/rss/news" },
            { source: "Times of India", url: "https://timesofindia.indiatimes.com/rssfeedstopstories.cms" },
            { source: "Economic Times", url: "https://economictimes.indiatimes.com/rssfeedstopstories.cms" },
            { source: "Business Line", url: "https://www.thehindubusinessline.com/news/feeder/default.rss" },
            { source: "Business Standard", url: "https://www.business-standard.com/rss/4/all-news.rss" },
            { source: "Hindustan Times", url: "https://www.hindustantimes.com/rss/india-news/rssfeed.xml" }
        ];

        // Helper function to get the current date in IST
        function getISTToday() {
            const now = new Date();
            const istOffset = 5.5 * 60 * 60 * 1000;
            const localOffset = now.getTimezoneOffset() * 60 * 1000;
            const utcTime = now.getTime() + localOffset;
            const istTime = utcTime + istOffset;
            return new Date(istTime).toISOString().slice(0, 10);
        }

        // Fetch and parse RSS via rss2json (secure proxy)
        async function fetchRSS(feed) {
            try {
                const apiURL = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`;
                const res = await fetch(apiURL);
                const data = await res.json();
                const items = data.items;

                if (!items) {
                    console.error("No items found or invalid feed:", feed.source);
                    return [];
                }

                const todayIST = getISTToday();

                return items.filter(item => {
                    const itemPubDate = new Date(item.pubDate);
                    const itemPubDateIST = new Date(itemPubDate.getTime() + (5.5 * 60 * 60 * 1000));
                    return itemPubDateIST.toISOString().slice(0, 10) === todayIST;
                }).map(item => ({
                    date: todayIST,
                    title: item.title || "No title",
                    summary: (item.description || item.content || "").replace(/<[^>]+>/g, "").slice(0, 150) + "...",
                    link: item.link || "#",
                    tags: [feed.source, ...(item.categories || [])]
                }));
            } catch (err) {
                console.error("Error fetching:", feed.source, err);
                return [];
            }
        }

        async function loadCurrentAffairs() {
            let articles = [];

            for (const f of feeds) {
                const list = await fetchRSS(f);
                articles = articles.concat(list);
            }

            articles.sort((a, b) => new Date(b.date) - new Date(a.date));

            currentAffairs.length = 0;
            currentAffairs.push(...articles);

            filterAffairs();
        }

        // ================== POP-UP LOGIC ==================
        function showPopup(popupId) {
            const popup = document.getElementById(popupId);
            const overlay = document.getElementById("overlay");
            if (popup && !popup.classList.contains("show")) {
                overlay.style.display = "block";
                popup.classList.add("show");
            }
        }

        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                document.getElementById("overlay").style.display = "none";
                popup.classList.remove("show");
            }
        }

        // ================== INIT ==================
        function init() {
            renderPapers();
            loadCurrentAffairs();
            setInterval(renderPapers, 60000);

            // Schedule the first pop-up after a 3-second delay
            setTimeout(() => showPopup('subscriptionPopup'), 3000);

            // Schedule the second pop-up after a 10-second delay
            setTimeout(() => showPopup('offerPopup'), 10000);

            // Then, show the subscription pop-up again every 2 minutes
            setInterval(() => showPopup('subscriptionPopup'), 120000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>